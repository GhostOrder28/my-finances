"use strict";(self["webpackChunkmy_finances"]=self["webpackChunkmy_finances"]||[]).push([[717],{6717:function(t,e,a){a.r(e),a.d(e,{default:function(){return O}});var n=a(3396),i=a(7139),s=a(9242);const r=t=>((0,n.dD)("data-v-be066f66"),t=t(),(0,n.Cn)(),t),o={id:"page-content"},l={id:"header"},m={key:0,id:"description"},c={key:1,id:"description"},f={class:"fh"},u={class:"description"},d={class:"input-container"},p=r((()=>(0,n._)("label",{for:"date",class:"f-rs"},"Fecha *",-1))),h={for:"date",class:"f-rs"},y={key:0,class:"input-container"},g=r((()=>(0,n._)("label",{for:"initialPayment",class:"f-rs"},"Pago inicial",-1))),w={for:"initialPayment",class:"f-rs"},S=r((()=>(0,n._)("div",{id:"labels"},[(0,n._)("span",{class:"f-rs"},"Producto / Cantidad"),(0,n._)("span",{class:"f-rs"},"Precio unitario")],-1))),_={class:"content"},v=["onUpdate:modelValue","onInput"],b=["onUpdate:modelValue"],D=["onUpdate:modelValue"],E=["onClick"],$={class:"errorMessages"},P={for:"name"},U={for:"quantity"},k={for:"pricePerUnit"},C={id:"actions",ref:"actionsRef"},N=r((()=>(0,n._)("button",{type:"submit",form:"myform",class:"action-button confirm f-rs"},"Confirmar venta",-1))),q=r((()=>(0,n._)("button",{type:"button",class:"action-button danger f-rs"},"Cancelar",-1))),I=[N,q];function z(t,e,a,r,N,q){const z=(0,n.up)("Icon");return(0,n.wg)(),(0,n.iD)("section",o,[(0,n._)("h1",l,[(0,n._)("span",null,[(0,n.Wm)(z,{name:"new-sale"}),"newsale"===t.$route.name?((0,n.wg)(),(0,n.iD)("span",m,"Nueva venta realizada a")):(0,n.kq)("",!0),"editsale"===t.$route.name?((0,n.wg)(),(0,n.iD)("span",c,"Editar venta realizada a")):(0,n.kq)("",!0)]),(0,n._)("span",f,(0,i.zw)(t.clientName),1),(0,n._)("span",u,(0,i.zw)(t.clientNameDetails),1)]),(0,n._)("form",{onSubmit:e[4]||(e[4]=(0,s.iM)(((...e)=>t.handleSubmit&&t.handleSubmit(...e)),["prevent"])),id:"myform"},[(0,n._)("div",d,[p,(0,n.wy)((0,n._)("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=e=>t.formState.saleDate=e),name:"date"},null,512),[[s.nr,t.formState.saleDate]]),(0,n._)("label",h,(0,i.zw)(t.formErrors?t.formErrors.date:""),1)]),"newsale"===t.$route.name?((0,n.wg)(),(0,n.iD)("div",y,[g,(0,n.wy)((0,n._)("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=e=>t.initialPayment=e),name:"initialPayment"},null,512),[[s.nr,t.initialPayment]]),(0,n._)("label",w,(0,i.zw)(t.formErrors?t.formErrors.payments:""),1)])):(0,n.kq)("",!0),S,(0,n._)("div",{id:"items",ref:"itemsRef",style:(0,i.j5)({height:t.itemsContainerHeight+"px"})},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.formState.items,((a,r)=>((0,n.wg)(),(0,n.iD)("div",{class:"item",key:"item"+r},[(0,n._)("div",_,[(0,n._)("div",null,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e=>t.formState.items[r].name=e,onInput:e=>t.handlePress(e,r),name:"name",type:"text",class:"name"},null,40,v),[[s.nr,t.formState.items[r].name]]),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e=>t.formState.items[r].quantity=e,name:"quantity",type:"number",class:"quantity",onFocus:e[2]||(e[2]=t=>t.target.select()),onContextmenu:e[3]||(e[3]=(0,s.iM)((()=>{}),["prevent"]))},null,40,b),[[s.nr,t.formState.items[r].quantity]])]),(0,n._)("div",null,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e=>t.formState.items[r].pricePerUnit=e,name:"pricePerUnit",type:"number",class:"price"},null,8,D),[[s.nr,t.formState.items[r].pricePerUnit]]),(0,n._)("button",{onClick:e=>t.handleRemove(r),type:"button",class:"remove-btn"},[(0,n.Wm)(z,{name:"cross"})],8,E)])]),(0,n._)("div",$,[(0,n._)("label",P,(0,i.zw)(t.formErrors?t.formErrors[`name${r}`]:""),1),(0,n._)("label",U,(0,i.zw)(t.formErrors?t.formErrors[`quantity${r}`]:""),1),(0,n._)("label",k,(0,i.zw)(t.formErrors?t.formErrors[`pricePerUnit${r}`]:""),1)])])))),128))],4)],32),(0,n._)("div",C,I,512)])}var V=a(6089);function Z(t){return void 0!==t.payments}var H=a(8898),R=a(5072);const x={name:"",quantity:1,pricePerUnit:NaN};var M=(0,n.aZ)({data(){return{itemsContainerHeight:0,initialPayment:0,formState:{saleDate:"",items:[{...x},{...x}]},formErrors:void 0}},components:{Icon:V.Z},methods:{async handleSubmit(){console.log(JSON.stringify(this.formState,null,2));try{if("newsale"===this.$route.name){if(!Z(this.formState))return;await H.Z.patch(`/clients/${this.$route.params.clientid}/sales`,{...this.formState,items:this.getExistentItems()})}"editsale"===this.$route.name&&await H.Z.patch(`/clients/${this.$route.params.clientid}/sales/${this.$route.params.saleid}`,{...this.formState,items:this.getExistentItems()})}catch(t){(0,R.IZ)(t)&&(this.formErrors=t.response?.data.validationError)}},async handleRemove(t){const e=this.formState.items.filter(((e,a)=>t!==a));this.formState.items=e},handlePress(t,e){0!==t.target.value.length&&e===this.formState.items.length-1&&(this.formState.items=[...this.formState.items,{...x}])},getExistentItems(){return this.formState.items.filter(((t,e)=>e!==this.formState.items.length-1))},async getSaleData(){try{const{clientid:t,saleid:e}=this.$route.params,a=await H.Z.get(`/clients/${t}/sales/${e}?filter=saleform`);console.log("res",a.data.saleData);const{saleDate:n,items:i,clientName:s,clientNameDetails:r}=a.data.saleData;this.formState={saleDate:n,items:[...i,x]},this.clientName=s,this.clientNameDetails=r}catch(t){(0,R.IZ)(t)?this.formErrors=t.response?.data:console.error(t)}}},watch:{initialPayment(t){Z(this.formState)&&t>0&&(this.formState.payments=[{paymentDate:this.formState.saleDate,amount:t}])},formState(t){return console.log("formState new value: ",JSON.stringify(t,null,2)),t.payments},formErrors(t){console.log("formErrors",t)}},async beforeMount(){"editsale"===this.$route.name&&await this.getSaleData()},mounted(){const{itemsRef:t,actionsRef:e}=this.$refs;console.log("window height",window.innerHeight),console.log("itemsRef offset top",t.offsetTop),console.log("route",this.$route),this.itemsContainerHeight=window.innerHeight-t.offsetTop-e.clientHeight-50}}),F=a(89);const J=(0,F.Z)(M,[["render",z],["__scopeId","data-v-be066f66"]]);var O=J}}]);
//# sourceMappingURL=717.503e567c.js.map