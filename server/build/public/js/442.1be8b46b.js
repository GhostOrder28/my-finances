"use strict";(self["webpackChunkmy_finances"]=self["webpackChunkmy_finances"]||[]).push([[442],{6442:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var s=a(3396),n=a(7139),r=a(9242);const i={class:"container p-4"},o={class:"d-flex flex-column align-items-baseline gap-2 align-items-center"},l={class:"d-flex gap-2 align-items-center"},m={key:0,class:"fs-6"},c={key:1,class:"fs-6"},f={class:"fs-2 fw-bold"},u={class:"fs-6 fst-italic"},d={class:"d-flex flex-column align-items-start gap-3"},p=(0,s._)("h2",{class:"fs-6 m-0"},[(0,s._)("label",{for:"date"},"Fecha de venta")],-1),h={key:0,class:"d-flex flex-column align-items-start gap-3"},y=(0,s._)("h2",{class:"fs-6 m-0"},[(0,s._)("label",{for:"initialPayment"},"Pago inicial")],-1),g={for:"initialPayment"},S=(0,s._)("h2",{class:"fs-6 m-0 text-start"},"Productos",-1),w={class:"input-group gap-0"},$=["onUpdate:modelValue","onInput"],b=["onUpdate:modelValue"],D=["onUpdate:modelValue"],v=["onClick"],k={class:"errorMessages"},_={key:0,for:"name"},E={key:1,for:"quantity"},P={key:2,for:"pricePerUnit"};function x(e,t,a,x,q,U){const N=(0,s.up)("Icon"),C=(0,s.up)("date-picker"),Z=(0,s.up)("FormButtons");return(0,s.wg)(),(0,s.iD)("section",i,[(0,s._)("h1",o,[(0,s._)("span",l,[(0,s.Wm)(N,{name:"new-sale"}),"newsale"===e.$route.name?((0,s.wg)(),(0,s.iD)("span",m,"Nueva venta realizada a")):(0,s.kq)("",!0),"editsale"===e.$route.name?((0,s.wg)(),(0,s.iD)("span",c,"Editar venta realizada a")):(0,s.kq)("",!0)]),(0,s._)("span",f,(0,n.zw)(e.$route.query.clientName),1),(0,s._)("span",u,(0,n.zw)(e.$route.query.clientNameDetails),1)]),(0,s._)("form",{onSubmit:t[4]||(t[4]=(0,r.iM)(((...t)=>e.handleSubmit&&e.handleSubmit(...t)),["prevent"])),id:"myform",class:"d-flex flex-column gap-4 mt-4"},[(0,s._)("div",d,[p,(0,s.Wm)(C,{class:"date-picker",name:"date",value:e.formState.saleDate,"onUpdate:value":t[0]||(t[0]=t=>e.formState.saleDate=t),formatter:e.dateFormat},null,8,["value","formatter"])]),"newsale"===e.$route.name?((0,s.wg)(),(0,s.iD)("div",h,[y,(0,s.wy)((0,s._)("input",{class:"form-control",type:"number","onUpdate:modelValue":t[1]||(t[1]=t=>e.initialPayment=t),name:"initialPayment"},null,512),[[r.nr,e.initialPayment]]),(0,s._)("label",g,(0,n.zw)(e.formErrors?e.formErrors.payments:""),1)])):(0,s.kq)("",!0),(0,s._)("div",{class:"d-flex flex-column gap-3 overflow-scroll",ref:"itemsRef",style:(0,n.j5)({height:e.itemsContainerHeight+"px"})},[S,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.formState.items,((a,i)=>((0,s.wg)(),(0,s.iD)("div",{key:"item"+i},[(0,s._)("div",w,[(0,s.wy)((0,s._)("input",{class:"form-control name-field","onUpdate:modelValue":t=>e.formState.items[i].name=t,onInput:t=>e.handlePress(t,i),name:"name",type:"text",placeholder:"Nombre"},null,40,$),[[r.nr,e.formState.items[i].name]]),(0,s.wy)((0,s._)("input",{class:"form-control quantity-field","onUpdate:modelValue":t=>e.formState.items[i].quantity=t,name:"quantity",type:"number",onFocus:t[2]||(t[2]=e=>e.target.select()),onContextmenu:t[3]||(t[3]=(0,r.iM)((()=>{}),["prevent"]))},null,40,b),[[r.nr,e.formState.items[i].quantity]]),(0,s.wy)((0,s._)("input",{class:"form-control price-field","onUpdate:modelValue":t=>e.formState.items[i].pricePerUnit=t,name:"pricePerUnit",type:"number",placeholder:"Precio"},null,8,D),[[r.nr,e.formState.items[i].pricePerUnit]]),(0,s._)("button",{class:"btn btn-outline-danger delete-button",onClick:t=>e.handleRemove(i),type:"button"},[(0,s.Wm)(N,{name:"cross"})],8,v)]),(0,s._)("div",k,[e.formErrors&&e.formErrors[`name${i}`]?((0,s.wg)(),(0,s.iD)("label",_,(0,n.zw)(e.formErrors[`name${i}`]),1)):(0,s.kq)("",!0),e.formErrors&&e.formErrors[`quantity${i}`]?((0,s.wg)(),(0,s.iD)("label",E,(0,n.zw)(e.formErrors[`quantity${i}`]),1)):(0,s.kq)("",!0),e.formErrors&&e.formErrors[`pricePerUnit${i}`]?((0,s.wg)(),(0,s.iD)("label",P,(0,n.zw)(e.formErrors[`pricePerUnit${i}`]),1)):(0,s.kq)("",!0)])])))),128))],4)],32),(0,s.Wm)(Z,{ref:"actionsRef",confirmLabel:"newsale"===e.$route.name?"Confirmar venta":"Confirmar",onFormSubmit:e.handleSubmit,cancelLabel:"Cancelar"},null,8,["confirmLabel","onFormSubmit"])])}a(7658);var q=a(3784),U=a(737),N=a(3332);function C(e){return void 0!==e.payments}var Z=a(725),I=a(8898),z=a(5072);const F={name:"",quantity:1,pricePerUnit:NaN};var V=(0,s.aZ)({data(){return{itemsContainerHeight:0,initialPayment:0,formState:{saleDate:new Date,items:[{...F},{...F}],..."newsale"===this.$route.name?{payments:[]}:{}},formErrors:void 0,dateFormat:{stringify:e=>e?(0,U.Z)(e,"dd/MM/yyyy"):""}}},components:{Icon:q.Z,DatePicker:N.Z,FormButtons:Z.Z},methods:{async handleSubmit(){console.log(JSON.stringify(this.formState,null,2)),console.log("route name",this.$route.name);try{if("newsale"===this.$route.name){if(!C(this.formState))return;const e=await I.Z.patch(`/clients/${this.$route.params.clientid}/sales`,{...this.formState,items:this.getExistentItems()});this.$router.push({name:"sale",params:{clientid:this.$route.params.clientid,saleid:e.data.saleId}})}"editsale"===this.$route.name&&(await I.Z.patch(`/clients/${this.$route.params.clientid}/sales/${this.$route.params.saleid}`,{...this.formState,items:this.getExistentItems()}),this.$router.push({name:"sale",params:this.$route.params}))}catch(e){(0,z.IZ)(e)&&(this.formErrors=e.response?.data.validationError)}},async handleRemove(e){const t=this.formState.items.filter(((t,a)=>e!==a));this.formState.items=t},handlePress(e,t){0!==e.target.value.length&&t===this.formState.items.length-1&&(this.formState.items=[...this.formState.items,{...F}])},getExistentItems(){return this.formState.items.filter(((e,t)=>t!==this.formState.items.length-1))},async getSaleData(){try{const{clientid:e,saleid:t}=this.$route.params;if("editsale"===this.$route.name){const a=await I.Z.get(`/clients/${e}/sales/${t}?filter=saleform`);console.log("res",a.data.saleData);const{saleDate:s,items:n,clientName:r,clientNameDetails:i}=a.data.saleData;this.formState={saleDate:new Date(s),items:[...n,F]},this.clientName=r,this.clientNameDetails=i}}catch(e){(0,z.IZ)(e)?this.formErrors=e.response?.data:console.error(e)}}},watch:{initialPayment(e){C(this.formState)&&e>0&&(this.formState.payments=[{paymentDate:new Date(this.formState.saleDate),amount:e}])},"formState.saleDate":function(e){C(this.formState)&&this.formState.payments.length&&(this.formState.payments[0].paymentDate=new Date(e))},formState(e){return console.log("formState new value: ",JSON.stringify(e,null,2)),e.payments},formErrors(e){console.log("formErrors",e)}},async beforeMount(){await this.getSaleData()},mounted(){const{itemsRef:e,actionsRef:t}=this.$refs;this.itemsContainerHeight=window.innerHeight-e.offsetTop-t.$el.clientHeight-30}}),H=a(89);const M=(0,H.Z)(V,[["render",x]]);var R=M}}]);
//# sourceMappingURL=442.1be8b46b.js.map