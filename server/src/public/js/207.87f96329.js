"use strict";(self["webpackChunkmy_finances"]=self["webpackChunkmy_finances"]||[]).push([[207],{145:function(e,t,n){function a(e){const{tableRef:t}=e,n=t.children["0"],a=t.parentElement,l=Number(window.getComputedStyle(a).paddingBottom.slice(0,-2)),i=window.innerHeight-t.offsetTop-n.clientHeight-l;return i}n.d(t,{b:function(){return a}})},9151:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(3396),l=n(7139);function i(e,t,n,i,o,r){const s=(0,a.up)("Icon"),c=(0,a.up)("router-link");return(0,a.wg)(),(0,a.j4)(c,{class:"back-link d-flex align-items-center gap-2 text-decoration-none text-dark-teal lh-1",to:n.url},{default:(0,a.w5)((()=>[(0,a.Wm)(s,{name:"backlink"}),(0,a.Uk)(" "+(0,l.zw)(n.label),1)])),_:1},8,["to"])}var o=n(3784),r={props:{url:{type:Object,required:!0},label:{type:String,required:!0}},components:{Icon:o.Z}},s=n(89);const c=(0,s.Z)(r,[["render",i]]);var d=c},9530:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(3396),l=n(7139);function i(e,t,n,i,o,r){const s=(0,a.up)("Icon");return(0,a.wg)(),(0,a.iD)("button",{class:"link-custom d-flex gap-2 align-items-center btn rounded-pill bg-red",type:"button",onClick:t[0]||(t[0]=t=>e.$emit(e.deleteEvent))},[(0,a._)("span",null,(0,l.zw)(e.label?"Eliminar":""),1),(0,a.Wm)(s,{name:"thrash"})])}var o=n(3784),r=(0,a.aZ)({props:{label:{type:Boolean,required:!1},deleteEvent:{type:String,required:!0}},components:{Icon:o.Z}}),s=n(89);const c=(0,s.Z)(r,[["render",i]]);var d=c},2845:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(3396),l=n(7139);function i(e,t,n,i,o,r){const s=(0,a.up)("Icon"),c=(0,a.up)("router-link");return(0,a.wg)(),(0,a.j4)(c,{class:"link-custom d-flex gap-2 align-items-center btn rounded-pill bg-turquoise text-decoration-none",to:n.url},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(n.label?"Modificar":"")+" ",1),(0,a.Wm)(s,{name:"edit"})])),_:1},8,["to"])}var o=n(3784),r={props:{url:{type:Object,required:!0},label:{type:Boolean,required:!1}},components:{Icon:o.Z}},s=n(89);const c=(0,s.Z)(r,[["render",i]]);var d=c},7105:function(e,t,n){n.d(t,{Z:function(){return p}});var a=n(3396),l=n(7139);const i={class:"d-flex flex-column gap-4 justify-content-center align-items-center bg-white bg-opacity-75 position-fixed top-0 container px-5 vw-100 vh-100"},o={class:"fs-3 fw-bold text-dark-teal"},r={class:"d-flex gap-3 w-100"};function s(e,t,n,s,c,d){return(0,a.wg)(),(0,a.j4)(a.lR,{to:"body"},[(0,a._)("div",i,[(0,a._)("p",o,(0,l.zw)(n.body),1),(0,a._)("div",r,[(0,a._)("button",{class:"flex-grow-1 py-2 rounded-pill border-0 bg-blue text-light-purple",type:"button",onClick:t[0]||(t[0]=t=>e.$emit(n.confirmEvent))},(0,l.zw)(n.confirmLabel),1),(0,a._)("button",{class:"flex-grow-1 py-2 rounded-pill border-0 bg-red text-light-red",onClick:t[1]||(t[1]=t=>e.$emit(n.rejectEvent))},(0,l.zw)(n.rejectLabel),1)])])])}var c={props:{body:{type:String,required:!0},rejectLabel:{type:String,required:!0},confirmLabel:{type:String,required:!0},confirmEvent:{type:String,required:!0},rejectEvent:{type:String,required:!0}}},d=n(89);const u=(0,d.Z)(c,[["render",s]]);var p=u},5121:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(3396),l=n(7139);function i(e,t,n,i,o,r){const s=(0,a.up)("Icon"),c=(0,a.up)("router-link");return(0,a.wg)(),(0,a.j4)(c,{class:"position-fixed bottom-0 end-0 m-3 py-2 px-3 rounded-pill d-flex gap-2 align-items-center fs-6 fw-bold bg-blue text-purple text-decoration-none",to:e.url},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(e.label)+" ",1),(0,a.Wm)(s,{name:"plus"})])),_:1},8,["to"])}var o=n(3784),r=(0,a.aZ)({props:{label:{type:String,required:!0},url:{type:Object,required:!0}},components:{Icon:o.Z}}),s=n(89);const c=(0,s.Z)(r,[["render",i]]);var d=c},7052:function(e,t,n){n.d(t,{Z:function(){return u}});var a=n(3396),l=n(7139);const i={class:"position-fixed top-0 d-flex flex-column justify-content-center align-items-center gap-3 w-100 vh-100 fs-5 fw-bold bg-white opacity-75"},o=(0,a._)("div",{class:"spinner-border text-green"},null,-1);function r(e,t,n,r,s,c){return(0,a.wg)(),(0,a.iD)("div",i,[o,(0,a._)("p",null,(0,l.zw)(n.msg),1)])}var s={props:{msg:{type:String,required:!1}}},c=n(89);const d=(0,c.Z)(s,[["render",r]]);var u=d},1578:function(e,t,n){n.d(t,{Z:function(){return g}});var a=n(3396),l=n(7139);const i={class:"d-flex flex-column align-items-start flex-grow-1"},o={class:"d-flex gap-1"},r={class:"fs-6"},s={class:"fs-2 fw-bolder"};function c(e,t,n,c,d,u){const p=(0,a.up)("Icon");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("div",o,[(0,a.Wm)(p,{name:n.icon},null,8,["name"]),(0,a._)("h2",r,(0,l.zw)(n.label),1)]),(0,a._)("span",s,"S/ "+(0,l.zw)(n.value),1)])}var d=n(3784),u={props:{icon:{required:!0,type:String},label:{required:!0,type:String},value:{required:!0,type:String}},components:{Icon:d.Z}},p=n(89);const m=(0,p.Z)(u,[["render",c]]);var g=m},4207:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var a=n(3396),l=n(7139);const i={class:"container d-flex flex-column gap-3 bg-green px-4 py-3"},o={class:"d-flex justify-content-between gap-2"},r={class:"d-flex flex-column gap-2 text-start"},s={class:"fs-5 fw-bold m-0"},c={class:"fw-bold"},d={class:"d-flex flex-column gap-2"},u={class:"d-flex"},p={class:"container p-0"},m={class:"w-100 d-flex"},g={class:"p-3"},y={class:"table table-fixed w-100 m-0 overflow-hidden",ref:"tableRef"},f={key:0,class:"d-table w-100 fs-6"},w=(0,a._)("tr",null,[(0,a._)("th",{class:"text-start",style:{width:"40%"}},"Producto"),(0,a._)("th",{class:"text-center",style:{width:"20%"}},"Cantidad"),(0,a._)("th",{class:"text-end",style:{width:"20%"}},"Precio"),(0,a._)("th",{class:"text-end",style:{width:"20%"}},"Total")],-1),b=[w],h={key:1,class:"d-table w-100 fs-6"},D=(0,a._)("tr",null,[(0,a._)("th",{class:"text-start"},"Fecha de pago"),(0,a._)("th",{class:"text-end"},"Cantidad")],-1),v=[D],x={class:"text-start",height:"50px",style:{width:"40%"}},_={class:"text-center",height:"50px",style:{width:"20%"}},k={class:"text-end",height:"50px",style:{width:"20%"}},S={class:"text-end",height:"50px",style:{width:"20%"}},P=["onPointerdown"],Z={class:"text-start",height:"50px"};function q(e,t,n,w,D,q){const $=(0,a.up)("BackLink"),j=(0,a.up)("EditButton"),C=(0,a.up)("DeleteButton"),I=(0,a.up)("StatItem"),N=(0,a.up)("Modal"),z=(0,a.up)("PopupButton"),L=(0,a.up)("Spinner");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("section",i,[(0,a._)("div",o,[(0,a._)("div",r,[(0,a.Wm)($,{label:"Regresar al cliente",url:{name:"client",params:{clientid:e.$route.params.clientid}}},null,8,["url"]),(0,a._)("h1",s,"Venta a "+(0,l.zw)(e.clientData?e.clientData.clientName:""),1),(0,a._)("time",c,"realizada el "+(0,l.zw)(e.clientData?e.clientData.sale.saleDate:""),1)]),(0,a._)("div",d,[(0,a.Wm)(j,{url:{name:"editsale",params:{clientid:e.$route.params.clientid,saleid:e.$route.params.saleid},query:{clientName:e.clientData?.clientName,clientNameDetails:e.clientData?.clientNameDetails}},label:!0},null,8,["url"]),(0,a.Wm)(C,{deleteEvent:"deleteSaleIntent",onDeleteSaleIntent:e.declareSaleDeletionIntent,label:!0},null,8,["onDeleteSaleIntent"])])]),(0,a._)("div",u,[(0,a.Wm)(I,{icon:"total-value",label:"Valor total",value:e.clientData?e.clientData.sale.saleValue:NaN},null,8,["value"]),(0,a.Wm)(I,{icon:"amount-paid",label:"Monto pagado",value:e.clientData?e.clientData.sale.paidAmount:NaN},null,8,["value"]),(0,a.Wm)(I,{icon:"debt",label:"Deuda",value:e.clientData?e.clientData.sale.unpaidAmount:NaN},null,8,["value"])])]),(0,a._)("section",p,[(0,a._)("div",m,[(0,a._)("button",{name:"products",class:(0,l.C_)(`flex-grow-1 w-50 border-0 fs-6 fw-bold ${"products"===e.currentView?"bg-dark-blue":"bg-blue"} text-light-purple py-2`),onClick:t[0]||(t[0]=(...t)=>e.changeView&&e.changeView(...t))}," PRODUCTOS ",2),(0,a._)("button",{name:"payments",class:(0,l.C_)(`flex-grow-1 w-50 border-0 fs-6 fw-bold ${"payments"===e.currentView?"bg-dark-blue":"bg-blue"} text-light-purple py-2`),onClick:t[1]||(t[1]=(...t)=>e.changeView&&e.changeView(...t))}," PAGOS ",2)]),(0,a._)("div",g,[(0,a._)("table",y,["products"===e.currentView?((0,a.wg)(),(0,a.iD)("thead",f,b)):(0,a.kq)("",!0),"payments"===e.currentView?((0,a.wg)(),(0,a.iD)("thead",h,v)):(0,a.kq)("",!0),"products"===e.currentView&&e.clientData?((0,a.wg)(),(0,a.iD)("tbody",{key:2,style:(0,l.j5)({height:e.tbodyHeight+"px"}),class:"d-block w-100 table-group-divider pb-5 overflow-scroll"},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.clientData.sale.items,((e,t)=>((0,a.wg)(),(0,a.iD)("tr",{key:"item"+t,class:"d-table w-100 align-middle"},[(0,a._)("td",x,(0,l.zw)(e.name),1),(0,a._)("td",_,(0,l.zw)(e.quantity),1),(0,a._)("td",k,"S/ "+(0,l.zw)(e.pricePerUnit),1),(0,a._)("td",S,"S/ "+(0,l.zw)(e.pricePerUnit*e.quantity),1)])))),128))],4)):(0,a.kq)("",!0),"payments"===e.currentView&&e.clientData?((0,a.wg)(),(0,a.iD)("tbody",{key:3,style:(0,l.j5)({height:e.tbodyHeight+"px"}),class:"d-block w-100 table-group-divider pb-5 overflow-y-scroll"},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.clientData.sale.payments,((t,n)=>((0,a.wg)(),(0,a.iD)("tr",{key:"item"+n,class:(0,l.C_)(`position-relative d-table w-100 align-middle ${e.toggleSelectedRow(n)}`),onPointerdown:t=>e.startLongPress(n)},[(0,a._)("td",Z,(0,l.zw)(t.paymentDate),1),(0,a._)("td",{class:(0,l.C_)(`text-end ${e.getPaymentStyle(n)}`),height:"50px"},"S/ "+(0,l.zw)(t.amount),3),(0,a._)("td",{class:(0,l.C_)(`position-absolute end-0 d-flex justify-content-end gap-2 ${e.toggleActionPanel(n)}`),height:"50px"},[(0,a.Wm)(j,{url:{name:"editpayment",params:{clientid:e.$route.params.clientid,saleid:e.$route.params.saleid,paymentid:t._id},query:{clientName:e.clientData?.clientName,clientNameDetails:e.clientData?.clientNameDetails}},label:!1},null,8,["url"]),(0,a.Wm)(C,{deleteEvent:"deletePaymentIntent",onDeletePaymentIntent:n=>e.declarePaymentDeletionIntent(t._id),label:!1},null,8,["onDeletePaymentIntent"])],2)],42,P)))),128))],4)):(0,a.kq)("",!0)],512)])]),e.displaySaleDeletionConfirmation?((0,a.wg)(),(0,a.j4)(N,{key:0,body:"¿Deseas eliminar esta venta?",confirmLabel:"Sí, bórrala",rejectLabel:"No",confirmEvent:"deleteSale",rejectEvent:"reject",onDeleteSale:e.deleteSale,onReject:t[2]||(t[2]=t=>e.displaySaleDeletionConfirmation=!1)},null,8,["onDeleteSale"])):(0,a.kq)("",!0),e.displayPaymentDeletionConfirmation?((0,a.wg)(),(0,a.j4)(N,{key:1,body:"¿Deseas eliminar este pago?",confirmLabel:"Sí, bórralo",rejectLabel:"No",confirmEvent:"deletePayment",rejectEvent:"reject",onDeletePayment:t[3]||(t[3]=t=>e.deletePayment(e.paymentToDelete)),onReject:t[4]||(t[4]=t=>e.displayPaymentDeletionConfirmation=!1)})):(0,a.kq)("",!0),(0,a.Wm)(z,{label:"Añadir pago",url:{name:"newpayment",params:{clientid:e.$route.params.clientid,saleid:e.$route.params.saleid},query:{clientName:e.clientData?.clientName,clientNameDetails:e.clientData?.clientNameDetails}}},null,8,["url"]),e.isLoading?((0,a.wg)(),(0,a.j4)(L,{key:2})):(0,a.kq)("",!0)],64)}var $=n(5121),j=n(1578),C=n(145),I=n(5072),N=n(8898),z=n(737),L=n(2845),E=n(9530),V=n(9151),W=n(7105),B=n(7052),A=(0,a.aZ)({data(){return{displayPaymentDeletionConfirmation:!1,displaySaleDeletionConfirmation:!1,paymentToDelete:void 0,pressTimeoutId:void 0,clientData:void 0,currentView:"products",tbodyHeight:0,actionPanel:void 0,isLoading:!1}},components:{StatItem:j.Z,PopupButton:$.Z,EditButton:L.Z,DeleteButton:E.Z,BackLink:V.Z,Modal:W.Z,Spinner:B.Z},methods:{changeView(e){this.currentView=e.target.name},async getSaleData(){try{this.isLoading=!0;const{clientid:e,saleid:t}=this.$route.params,n=await N.Z.get(`/clients/${e}/sales/${t}`),a={...n.data.saleData};a.sale.saleDate=(0,z.Z)(new Date(a.sale.saleDate),"dd-MM-yyyy"),console.log("parsedRes: ",a),a.sale.payments=a.sale.payments.map((e=>({...e,paymentDate:(0,z.Z)(new Date(e.paymentDate),"dd-MM-yyyy")}))),this.clientData=a,this.isLoading=!1}catch(e){throw(0,I.IZ)(e)?(this.isLoading=!1,console.error(e.response),new Error(`there was an error when requesting the sale data, ${e.response}`)):(this.isLoading=!1,new Error(`there was an error, ${e}`))}},onLongPressStop(e,t){console.log(`row ${t} was pressed`),this.actionPanel=t},getPaymentStyle(e){return e===this.actionPanel?"payment-td":""},toggleActionPanel(e){return e===this.actionPanel?"action-panel-active":"action-panel"},toggleSelectedRow(e){return e===this.actionPanel?"row-selected":""},startLongPress(e){this.pressTimeoutId=setTimeout((()=>{this.actionPanel=e}),500)},declarePaymentDeletionIntent(e){this.paymentToDelete=e,this.displayPaymentDeletionConfirmation=!0},declareSaleDeletionIntent(){this.displaySaleDeletionConfirmation=!0},async deletePayment(e){if(!e)return;const{clientid:t,saleid:n}=this.$route.params,a=await N.Z.patch(`/clients/${t}/sales/${n}/payments/${e}?delete=true`);this.clientData&&(this.clientData.sale.payments=this.clientData.sale.payments.filter((t=>t._id!==e)),this.clientData.sale.unpaidAmount=a.data.affectedSaleFields.unpaidAmount,this.clientData.sale.paidAmount=a.data.affectedSaleFields.paidAmount),this.displayPaymentDeletionConfirmation=!1,this.paymentToDelete=void 0,this.actionPanel=void 0},async deleteSale(){console.log("deleting this sale");const{clientid:e,saleid:t}=this.$route.params;await N.Z.patch(`/clients/${e}/sales/${t}?delete=true`),this.$router.back()}},watch:{clientData(e){console.log("new value",e)}},async beforeMount(){await this.getSaleData()},mounted(){console.log(this.$route);const e=(0,C.b)(this.$refs);this.tbodyHeight=e}}),R=n(89);const T=(0,R.Z)(A,[["render",q]]);var H=T}}]);
//# sourceMappingURL=207.87f96329.js.map